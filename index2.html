<!doctype html>
<meta charset="utf-8">
<script type="text/javascript" src="jquery-1.10.2.js"></script>
<script type="text/javascript" src="jquery-ui.js"></script>
<link rel="stylesheet" href="jquery-ui.css">
<script src="http://www.d3plus.org/js/d3.js"></script>
<script src="http://www.d3plus.org/js/d3plus.js"></script>

<div style="width: 50%; margin-left:25%;">
	<p>
	<label for="year">年份：</label>
	<input type="text" id="year" readonly style="font-size: 24px; border:0; color:#f6931f; font-weight:bold;">
	</p>
	<div id="slider-range-min-year"></div>
	<p>
	<label for="month">月份：</label>
	<input type="text" id="month" readonly style="font-size: 24px; border:0; color:#f6931f; font-weight:bold;">
	</p>
	<div id="slider-range-min-month"></div>
</div>
<form>
  <label><input type="radio" name="mode" value="export" checked> 出口</label>
  <label><input type="radio" name="mode" value="import"> 進口</label>
</form>
<div id="viz"></div>
<script>
	d3.csv("trade_export.csv", function(export_data) {
	d3.csv("trade_import.csv", function(import_data) {
	console.log(export_data);
	createTimeLine();
	var date="Y2015M12";
	var rYear=2015;
	var rMonth=12;
	var type="export";

	for (var i = 0; i < export_data.length; i++) {
		export_data[i][date] = parseInt(export_data[i][date]);
	}
	var initial_visualization = d3plus.viz()
    .container("#viz")
    .data(export_data)
    .type("tree_map")
    .id(["group","country"])
    .size(date)
    .draw()
	

	d3.selectAll("input").on("change", function change() {
    type = this.value;
	if(type=="export")
	{
		for (var i = 0; i < export_data.length; i++) {
			export_data[i][date] = parseInt(export_data[i][date]);
		}
		var toggle_visualization = d3plus.viz()
		.container("#viz")
		.data(export_data)
		.type("tree_map")
		.id(["group","country"])
		.size(date)
		.draw()
	}
	else
	{
		for (var i = 0; i < import_data.length; i++) {
			import_data[i][date] = parseInt(import_data[i][date]);
		}
		var toggle_visualization = d3plus.viz()
		.container("#viz")
		.data(import_data)
		.type("tree_map")
		.id(["group","country"])
		.size(date)
		.draw()	
	}
});

//Timeline
function createTimeLine() {
    $("#slider-range-min-year").slider({
        range: "min",
        value: 2015,
        min: 2000,
        max: 2015,
        slide: function( event, ui ) { //滾動時間時
            $( "#year" ).val( ui.value );
			changeYear(ui.value);
        }
    });
    $("#year").val( $( "#slider-range-min-year" ).slider( "value" ) );
	$("#slider-range-min-month").slider({
        range: "min",
        value: 12,
        min: 1,
        max: 12,
        slide: function( event, ui ) { //滾動時間時
            $( "#month" ).val( ui.value );
			changeMonth(ui.value);
        }
    });
    $("#month").val( $( "#slider-range-min-month" ).slider( "value" ) );
};
function changeYear(year) {
	rYear = year;
	date="Y"+rYear+"M"+rMonth;
	if(type=="export")
	{
		for (var i = 0; i < export_data.length; i++) {
			export_data[i][date] = parseInt(export_data[i][date]);
		}
		var new_visualization = d3plus.viz()
		.container("#viz")
		.data(export_data)
		.type("tree_map")
		.id(["group","country"])
		.size(date)
		.draw()
	}
	else
	{
		for (var i = 0; i < import_data.length; i++) {
			import_data[i][date] = parseInt(import_data[i][date]);
		}
		var new_visualization = d3plus.viz()
		.container("#viz")
		.data(import_data)
		.type("tree_map")
		.id(["group","country"])
		.size(date)
		.draw()
	}
};
function changeMonth(month) {
	rMonth = month;
	date="Y"+rYear+"M"+rMonth;
	if(type=="export")
	{
		for (var i = 0; i < export_data.length; i++) {
			export_data[i][date] = parseInt(export_data[i][date]);
		}
		var new_visualization = d3plus.viz()
		.container("#viz")
		.data(export_data)
		.type("tree_map")
		.id(["group","country"])
		.size(date)
		.draw()
	}
	else
	{
		for (var i = 0; i < import_data.length; i++) {
			import_data[i][date] = parseInt(import_data[i][date]);
		}
		var new_visualization = d3plus.viz()
		.container("#viz")
		.data(import_data)
		.type("tree_map")
		.id(["group","country"])
		.size(date)
		.draw()
	}
};

});
});
	


</script>
